- auto
- name: TrainingStatisticExtractionCalculator
  builder: lm_polygraph.defaults.stat_calculator_builders.default_TrainingStatisticExtractionCalculator
  cfg:
    dataset: '${dataset}'
    text_column: '${text_column}'
    label_column: '${label_column}'
    description: ''
    prompt: ''
    few_shot_split: "train"
    train_split: '${train_split}'
    load_from_disk: '${load_from_disk}'
    subsample_train_dataset: 1000
    n_shot: 5
    background_train_dataset: allenai/c4
    background_train_dataset_text_column: text
    background_train_dataset_label_column: url
    background_train_dataset_data_files: en/c4-train.00000-of-01024.json.gz
    background_load_from_disk: false
    subsample_background_train_dataset: 1000
    batch_size: '${batch_size}'
    seed: '${seed}'
    size: '${size}'
    bg_size: 100000
    output_attentions: True
  stats: 
    - "train_embeddings"
    - "background_train_embeddings"
    - "train_greedy_log_likelihoods"
  dependencies:
- name: TrainMTopDivCalculator
  builder: lm_polygraph.defaults.stat_calculator_builders.default_TrainMTopDivCalculator
  cfg:
    heads_extraction_priority: cache
    cache_path: '${model_heads_cache}'
    max_heads: '${max_heads}'
    n_jobs: '${n_jobs}'
    train_data_path: '${train_dataset.train_data_path}'
    context_column: '${train_dataset.context_column}'
    question_column: '${train_dataset.question_column}'
    prompt_column: '${train_dataset.prompt_column}'
    response_column: '${train_dataset.response_column}'
    label_column: '${train_dataset.label_column}'
    batch_size: '${batch_size}'
    subsample_train_dataset: '${train_dataset.subsample}'
    seed: '${seed}'
  stats: 
    - "topological_divergence_heads"
  dependencies: